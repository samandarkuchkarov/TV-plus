function GamesScreen(){var that=this;var gamesMenu=new BaseMenu({menuId:"games-menu",menuTag:"ul",itemIdPrefix:"games-menu",itemTag:"li",useFastRefresh:true,relatedItemIdPrefix:"games-selector",getItemNameFunc:function(realItemIndex,itemIndex,node){var game=menuItems[realItemIndex];if(!node){return true}else{var cls;var dateStr,scoreStr;if(game.last_date!==0){var month=game.last_date.substr(5,2);if(month[0]==="0"){month=parseInt(month[1])}month--;dateStr=game.last_date.substr(8,2)+" "+App.lang.get("month-"+month)+" "+game.last_date.substr(0,4);scoreStr=game.last_score}else{dateStr="---";scoreStr="---"}var iconElement=document.createElement("span");iconElement.setAttribute("class","icon");iconElement.setAttribute("id",game.system_name);var nameElement=document.createElement("div");nameElement.innerHTML=game.name;var infoElement=document.createElement("div");infoElement.setAttribute("class","games-info");var dateElement=document.createElement("div");dateElement.setAttribute("class","games-date");var spanElement=document.createElement("span");spanElement.innerHTML=App.lang.get("last-game")+": ";dateElement.appendChild(spanElement);dateElement.innerHTML+=dateStr;var scoreElement=document.createElement("div");scoreElement.setAttribute("class","games-score");var spanElement2=document.createElement("span");spanElement2.innerHTML=App.lang.get("points")+": ";scoreElement.appendChild(spanElement2);scoreElement.innerHTML+=scoreStr;infoElement.appendChild(dateElement);infoElement.appendChild(scoreElement);node.appendChild(iconElement);node.appendChild(nameElement);node.appendChild(infoElement)}},onItemClick:function(index){that.key_enter()},onItemMouseOver:function(index){var sourceItems=gamesMenu.getCurrentPage()*gamesMenu.getNumberOfDisplayItems()+index;gamesMenu.setSelectedItem(index,sourceItems)}});var selectorMenu=new BaseMenu({displayItemsNumber:5,sourceItemsNumber:5,menuId:"games-selector",menuTag:"div",itemIdPrefix:"games-selector",itemTag:"div",useFastRefresh:false});var indexOfSelection;var menuItems=[];this.show=function(){menuItems=[];gamesMenu.clear();indexOfSelection=0;var total=0;Helper.hideById("games-total");App.data.requestGamesList({},function(error){menuItems=App.data.getGameList();if(menuItems.length>0){Helper.hideById("games-empty-list");var n=menuItems.length;if(n>3){n=3}var gamesSelectorElement=Helper.byId("games-selector");gamesSelectorElement.innerHTML="";for(var i=0;i<n;i++){var gamesSelectorItemElement=document.createElement("div");gamesSelectorItemElement.setAttribute("id","games-selector"+i);gamesSelectorElement.appendChild(gamesSelectorItemElement)}gamesMenu.setNumberOfDisplayItems(n);gamesMenu.setNumberOfSourceItems(menuItems.length);gamesMenu.setSelectedItem(0,0);App.data.requestGameScoreList({},function(error){var totalScore=App.data.getGameTotalScore();if(totalScore){Helper.showById("games-total");Helper.setHtml("games-total-score",totalScore);if(!Helper.isVisible("label-games-total")){Helper.showById("label-games-total")}}else{Helper.hideById("label-games-total")}})}else{if(!Helper.isVisible("games-empty-list")){Helper.showById("games-empty-list");Helper.hideById("games-total")}}_GamesScreen.show()})};this.reset=function(){_GamesScreen.setInited(false)};this.init=function(){_GamesScreen.init();Helper.removeClass("games-header","label-games");App.display.addScreen(App.gamesRecordsScreen,"games-records");App.battleCityScreen.setId("games-battle_city-screen");App.display.addScreen(App.battleCityScreen,"games-battle_city")};this.key_back=function(){this.key_exit()};this.key_yellow=function(){App.data.requestGameScoreboardList({game:menuItems[gamesMenu.getSelectedDisplayItem()]["system_name"]},function(error){var game=menuItems[gamesMenu.getSelectedDisplayItem()];Helper.setHtml("current-game",game.name);App.display.showScreen("games-records")})};this.key_down=function(){gamesMenu.setNextItem()};this.key_up=function(){gamesMenu.setPreviousItem()};this.key_enter=function(){var systemNameOfSelectedGame=menuItems[gamesMenu.getSelectedDisplayItem()]["system_name"];App.display.showScreen("games-"+systemNameOfSelectedGame)};this.key_menu=function(){App.display.showScreen("mainmenu")};this.key_exit=function(){App.display.showScreen("apps")};this.key_backspace=function(){this.key_exit()};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){var keys=[{action:"menu",label:"label-menu"},{action:"yellow",label:"label-games-records"},{action:"back",label:"label-back"}];App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("games");App.display.showPopupScreen("popup-key-panel")}else{this.key_enter()}}}_GamesScreen=new BaseScreen();GamesScreen.prototype=_GamesScreen;