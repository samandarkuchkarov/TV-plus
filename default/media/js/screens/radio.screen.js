function RadioScreen(){var radioStations=[];var dataLoaded=false;var stationNumberStr="";var stationNumberPadTimeout=null;var selectedStationIndex=0;var numberOfColumnItems=0;var timeInterval=null;var that=this;var customDataBackend=App.clientSettings.custom_data_backend?true:false;var selectorMenu=new BaseMenu({displayItemsNumber:1,sourceItemsNumber:1,menuId:"radio-selector",menuTag:"div",itemIdPrefix:"radio-selector",itemTag:"div",useFastRefresh:false,useMovableSelectionEffect:true});var radioStationsMenu=new BaseMenu({menuId:"radiostations-menu",menuTag:"ul",itemIdPrefix:"station",itemTag:"li",useFastRefresh:true,hideItemIfEmptyName:true,relatedItemIdPrefix:"radio-selector",getRelatedDisplayItemIndexFunc:function(itemIndex){var ind=itemIndex;if(itemIndex>=numberOfColumnItems){ind=itemIndex-numberOfColumnItems}return ind},getItemNameFunc:function(realItemIndex,itemIndex,node){var station=(customDataBackend)?radioStations[realItemIndex]:App.data.getRadioStation(realItemIndex);if(station){if(!node){return true}else{var stationName=station.name;var logoUrl=station.logo_url;if(!logoUrl){logoUrl="media/img/blank.png"}if(Device.getDeviceKind()==="amino"){stationName=Helper.cropString(stationName,12)}var numberElement=document.createElement("span");numberElement.setAttribute("class","number");numberElement.innerHTML=(realItemIndex+1);var logoElement=document.createElement("img");logoElement.setAttribute("src",Helper.getResourceUrl(logoUrl));var nameElement=document.createElement("span");nameElement.setAttribute("class","name");nameElement.innerHTML=stationName;node.appendChild(numberElement);node.appendChild(logoElement);node.appendChild(nameElement)}}else{return""}},onMenuItemsRedraw:function(){var menuItemsCount=radioStationsMenu.getNumberOfDisplayItems();if(Helper.byId("station"+numberOfColumnItems)){var i=numberOfColumnItems;do{if(Helper.byId("station"+i)){Helper.addClass("station"+i,"radio-col2")}else{break}i++}while(i<menuItemsCount)}},onItemClick:function(index){that.key_enter()},onItemMouseOver:function(index){var sourceItems=radioStationsMenu.getCurrentPage()*radioStationsMenu.getNumberOfDisplayItems()+index;radioStationsMenu.setSelectedItem(index,sourceItems)}});this.getSelectedStation=function(){return(customDataBackend)?radioStations[radioStationsMenu.getSelectedSourceItem()]:App.data.getRadioStation(radioStationsMenu.getSelectedSourceItem())};this.getRadiostationsCount=function(){return(customDataBackend)?radioStations.length:App.data.getNumberOfRadioStations()};this.resize=function(displayWidth,displayHeight){var stationItemHeight=Helper.byId("station0").offsetHeight+Helper.totalIndentVertical("station0");var n=10;Helper.byId("radiostations-menu").style.height=(n*stationItemHeight)+"px";numberOfColumnItems=n;n=n*2;var radioStationsCount=this.getRadiostationsCount();if(radioStationsCount>0&&radioStationsCount<n){n=radioStationsCount}var s="";for(var i=0;i<numberOfColumnItems;i++){s+='<div id="radio-selector'+i+'"></div>'}Helper.setHtml("radio-selector",s);radioStationsMenu.clear();radioStationsMenu.setNumberOfRows(n);radioStationsMenu.setNumberOfDisplayItems(n);radioStationsMenu.setNumberOfSourceItems(radioStationsCount);radioStationsMenu.setSelectedItem(0,0);radioStationsMenu.redrawMenuItems()};this.refresh=function(){radioStationsMenu.redrawMenuItems()};this.show=function(){App.playerScreen.hideTvInfoBar();App.playerScreen.hideVideoInfoBar();App.playerScreen.clearRefreshInfoCallback();_RadioScreen.show();if(!timeInterval){that.refreshDisplayTime();timeInterval=setInterval(App.radioScreen.refreshDisplayTime,15000)}Helper.showById("radio-clock");if(App.player.getState()===App.player.STATE_PLAYING&&App.player.getMode()===App.player.MODE_RADIO){Helper.showById("radio-player")}var device_kind=App.device.getDeviceKind();if(App.clientSettings.samsung_guidelines_compatibility_mode&&(device_kind==="lg_netcast"||device_kind==="lg_webos")){this.setOnHideCallback(function(){alert("hide callback");if(App.player.getMode()===App.player.MODE_RADIO){App.player.stop()}})}};this.hide=function(){Helper.hideById("radio-player");_RadioScreen.hide()};this.reset=function(){_RadioScreen.setInited(false)};this.init=function(){_RadioScreen.init();if(!customDataBackend){var ths=this;App.data.requestRadioList({},function(error){if(error==0){var n=App.data.getNumberOfRadioStations();if(n>radioStationsMenu.getNumberOfDisplayItems()){n=radioStationsMenu.getNumberOfDisplayItems()}if(n===0){Helper.showById("radio-empty-screen");Helper.hideById("radio-player")}else{Helper.hideById("radio-empty-screen");radioStationsMenu.clear();radioStationsMenu.setNumberOfDisplayItems(n);radioStationsMenu.setNumberOfSourceItems(App.data.getNumberOfRadioStations());radioStationsMenu.setSelectedItem(0,0);radioStationsMenu.redrawMenuItems()}}})}};this.refreshDisplayTime=function(){var now=Helper.withTimezone(App.data.getUtcTime());var d=new Date(now*1000);var date=("0"+d.getDate()).substr(-2,2)+" "+App.lang.get("month-"+d.getMonth())+" "+d.getFullYear();var timeStr=("0"+d.getHours()).substr(-2,2)+":"+("0"+d.getMinutes()).substr(-2,2);Helper.setHtml("radio-clock",date+" "+timeStr)};this.playSelectedStation=function(){var station=that.getSelectedStation();if(!station){return}App.player.setOnStopCallback(null);App.player.setMode(App.player.MODE_RADIO);App.player.setChannel(null);App.player.setProgram(null);App.player.setPlayingItemId(station.id);App.player.setPlayingItemName(station.name);App.player.setStreamUrl(station.url);Helper.setHtml("radiostation-name",App.data.getRadioStation(radioStationsMenu.getSelectedSourceItem())["name"]);App.player.play()};this.key_back=function(){App.player.stop();App.display.showScreen("apps")};this.key_exit=this.key_back;this.key_backspace=this.key_back;this.key_menu=function(){App.display.showScreen("mainmenu")};this.key_up=function(){radioStationsMenu.setPreviousItem()};this.key_down=function(){radioStationsMenu.setNextItem()};this.key_up=Helper.stickyKeyPrevent(function(){radioStationsMenu.setPreviousItem()},40);this.key_down=Helper.stickyKeyPrevent(function(){radioStationsMenu.setNextItem()},40);this.key_left=Helper.stickyKeyPrevent(function(){var itemsCount=radioStationsMenu.getNumberOfDisplayItems();if(itemsCount<=numberOfColumnItems){radioStationsMenu.setPreviousItem()}else{var nextItemIndex=0;var nextItemRealIndex=0;var columnItemsCount=numberOfColumnItems;var selectedItem=radioStationsMenu.getSelectedDisplayItem();var menuRealItemCount=radioStationsMenu.getNumberOfSourceItems();var lastPageItemsCount=menuRealItemCount%itemsCount;nextItemIndex=selectedItem-columnItemsCount;if(selectedItem<columnItemsCount){nextItemIndex=selectedItem+columnItemsCount}nextItemRealIndex=radioStationsMenu.getSourceItemByDisplayItem(selectedItem)-columnItemsCount;if(nextItemRealIndex<0){if(menuRealItemCount<=columnItemsCount*2){nextItemIndex=(nextItemIndex>=menuRealItemCount-1)?menuRealItemCount-1:nextItemIndex;nextItemRealIndex=nextItemIndex}else{if(lastPageItemsCount<columnItemsCount){if(lastPageItemsCount===0){nextItemIndex=selectedItem+columnItemsCount;nextItemRealIndex=menuRealItemCount-((columnItemsCount*2)-nextItemIndex)}else{if(lastPageItemsCount>0){nextItemIndex=(lastPageItemsCount>selectedItem)?selectedItem:lastPageItemsCount-1;nextItemRealIndex=(lastPageItemsCount>selectedItem)?menuRealItemCount-(lastPageItemsCount-nextItemIndex):menuRealItemCount-1}}}else{if(lastPageItemsCount>columnItemsCount){nextItemIndex=selectedItem+columnItemsCount;if(nextItemIndex>=lastPageItemsCount){nextItemIndex=lastPageItemsCount-1}nextItemRealIndex=(nextItemIndex!==lastPageItemsCount-1)?menuRealItemCount-(lastPageItemsCount-nextItemIndex):menuRealItemCount-1}else{if(lastPageItemsCount===columnItemsCount){nextItemIndex=selectedItem;nextItemRealIndex=menuRealItemCount-(columnItemsCount-nextItemIndex)}}}}}radioStationsMenu.setSelectedItem(nextItemIndex,nextItemRealIndex)}},300);this.key_right=Helper.stickyKeyPrevent(function(){var itemsCount=radioStationsMenu.getNumberOfDisplayItems();if(itemsCount<=numberOfColumnItems){radioStationsMenu.setNextItem()}else{var nextItemIndex=0;var nextItemRealIndex=0;var columnItemsCount=numberOfColumnItems;var selectedItem=radioStationsMenu.getSelectedDisplayItem();var menuRealItemCount=radioStationsMenu.getNumberOfSourceItems();var lastPageItemsCount=menuRealItemCount%itemsCount;nextItemIndex=selectedItem+columnItemsCount;if(selectedItem>=columnItemsCount){nextItemIndex=selectedItem-columnItemsCount}nextItemRealIndex=radioStationsMenu.getSourceItemByDisplayItem(selectedItem)+columnItemsCount;if(nextItemRealIndex>=menuRealItemCount){if(menuRealItemCount<=columnItemsCount*2){nextItemIndex=(selectedItem<columnItemsCount)?menuRealItemCount-1:selectedItem-columnItemsCount;nextItemRealIndex=nextItemIndex}else{if(lastPageItemsCount<=columnItemsCount&&lastPageItemsCount>0){if(radioStationsMenu.getCurrentPage()===radioStationsMenu.getNumberOfPages()-1){nextItemIndex=selectedItem;nextItemRealIndex=nextItemIndex}else{nextItemIndex=selectedItem-columnItemsCount;if(nextItemIndex>=lastPageItemsCount){nextItemIndex=lastPageItemsCount-1}nextItemRealIndex=(nextItemIndex!==lastPageItemsCount-1)?menuRealItemCount-(lastPageItemsCount-nextItemIndex):menuRealItemCount-1}}else{if(selectedItem<columnItemsCount){nextItemIndex=selectedItem+columnItemsCount;if(nextItemIndex>=lastPageItemsCount){nextItemIndex=lastPageItemsCount-1}nextItemRealIndex=(nextItemIndex!==lastPageItemsCount-1)?menuRealItemCount-(lastPageItemsCount-nextItemIndex):menuRealItemCount-1}else{nextItemIndex=selectedItem-columnItemsCount;nextItemRealIndex=nextItemIndex}}}}radioStationsMenu.setSelectedItem(nextItemIndex,nextItemRealIndex)}},300);this.key_enter=function(){this.playSelectedStation()};this.key_play=function(){if(App.player.getState()===App.player.STATE_PAUSED){App.player.resume()}};this.key_stop=function(){Helper.hideById("radio-player");App.player.stop()};this.key_pause=function(){if(App.player.getState()===App.player.STATE_PAUSED||App.player.getState()===App.player.STATE_STOPPED){App.player.resume()}else{Helper.hideById("radio-player");App.player.pause()}};this.key_power=function(){App.switchStandBy()};this.wheel=function(delta){if(delta>0){this.key_down()}else{this.key_up()}};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){var keys=[{action:"menu",label:"label-menu"},{action:"back",label:"label-back"}];App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("radio");App.display.showPopupScreen("popup-key-panel")}else{this.key_enter()}}}_RadioScreen=new BaseScreen();RadioScreen.prototype=_RadioScreen;