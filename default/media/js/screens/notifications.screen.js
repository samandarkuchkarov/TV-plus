function NotificationsScreen(){var that=this;var menuItems=[];var timeIntervalClock=null;var numberOfDisplayRows=10;var notificationsMenu=new BaseMenu({menuId:"notifications-menu",menuTag:"ul",itemIdPrefix:"notification",itemTag:"li",useFastRefresh:true,hideItemIfEmptyName:true,relatedItemIdPrefix:"notification-selector",getItemNameFunc:function(realItemIndex,itemIndex,node){var program=menuItems[realItemIndex];if(program){if(!node){return true}else{var timeshiftOffset=program.timeshift_offset*3600;var iconElement=document.createElement("img");iconElement.setAttribute("class","icon");iconElement.setAttribute("src",Helper.getResourceUrl(program.icon));node.appendChild(iconElement);if(program.has_record&&program.program_end_time<App.data.getUtcTime()){var epgHasRecordElement=document.createElement("span");epgHasRecordElement.setAttribute("class","epg-has-record");node.appendChild(epgHasRecordElement)}if(program.program_begin_time!==-1){var nameElement=document.createElement("span");nameElement.setAttribute("class","name");nameElement.innerHTML=App.settings.getStyleName()!=="impuls_x"?program.name:Helper.cropString(program.name,15,"..");var beginTimeElement=document.createElement("span");beginTimeElement.setAttribute("class","begin-time");beginTimeElement.innerHTML=that.formatDate(Helper.withTimezone(program.program_begin_time+timeshiftOffset));var programNameElement=document.createElement("span");programNameElement.setAttribute("class","program-name");programNameElement.innerHTML=program.program_name;node.appendChild(nameElement);node.appendChild(beginTimeElement);node.appendChild(programNameElement)}else{var programNameElement=document.createElement("span");programNameElement.innerHTML=program.program_name;node.appendChild(programNameElement)}}}else{return""}},onItemClick:function(index){that.key_enter()},onItemMouseOver:function(index){var sourceItems=notificationsMenu.getCurrentPage()*notificationsMenu.getNumberOfDisplayItems()+index;notificationsMenu.setSelectedItem(index,sourceItems)}});this.refresh=function(){App.notificationsScreen.refreshDisplayTime()};this.show=function(){App.playerScreen.hideTvInfoBar();App.playerScreen.hideVideoInfoBar();_NotificationsScreen.show();if(!timeIntervalClock){this.refreshDisplayTime();timeIntervalClock=setInterval(that.refreshDisplayTime,15000)}this.refreshNotificationList()};this.refreshDisplayTime=function(){var now=Helper.withTimezone(App.data.getUtcTime());Helper.setHtml("notifications-clock",App.notificationsScreen.formatDate(now))};this.formatDate=function(seconds){var d=new Date(seconds*1000);var date=("0"+d.getDate()).substr(-2,2)+" "+App.lang.get("month-"+d.getMonth())+" "+d.getFullYear();var timeStr=("0"+d.getHours()).substr(-2,2)+":"+("0"+d.getMinutes()).substr(-2,2);return date+" "+timeStr};this.refreshNotificationList=function(){menuItems=App.data.getNotificationList();notificationsMenu.clear();Helper.hideById("notifications-empty-category");Helper.showById("delete-notification-button");var n=menuItems.length;if(n===0){Helper.showById("notifications-empty-category");Helper.hideById("delete-notification-button")}else{if(n>numberOfDisplayRows){n=numberOfDisplayRows}notificationsMenu.setNumberOfDisplayItems(n);notificationsMenu.setNumberOfSourceItems(menuItems.length);notificationsMenu.setSelectedItem(0,0);notificationsMenu.redrawMenuItems()}};this.init=function(){_NotificationsScreen.init()};this.key_yellow=function(){if(menuItems.length!==0){var program=menuItems[notificationsMenu.getSelectedSourceItem()];App.loginScreen.askToExit("ask-delete-notification-msg",function(value){if(value){Helper.addClass("notifications-screen-container","loader");App.data.requestNotificationDelete({pid:program.program_id},function(error){App.refreshNotifications(function(){that.refreshNotificationList();Helper.removeClass("notifications-screen-container","loader")})})}})}};this.key_enter=function(){var program=menuItems[notificationsMenu.getSelectedSourceItem()];var programForPlayer={};for(var key in program){programForPlayer[key]=program[key]}programForPlayer.begin_time=program.program_begin_time;programForPlayer.end_time=program.program_end_time;programForPlayer.name=program.program_name;programForPlayer.description=program.program_description;App.playerScreen.setParentScreen("notifications");var channel=null;var number=App.data.getProgramCategoryChannelNumberById(program.id);if(number>=0){var index=App.data.getProgramCategoryChannelIndexByNumber(number);if(index>=0){channel=App.data.getProgramCategoryChannel("all",index)}}else{channel=App.data.getChannelById(program.id,true)}if(program.program_end_time<App.data.getUtcTime()){if(channel){App.data.requestProgramUrl({cid:channel.id,time:program.program_begin_time},function(error,uri){program.url=uri;App.player.playProgram(channel,program)})}else{Helper.addClass("notifications-screen-container","loader");App.data.requestChannelList({icon_width:40,icon_height:40},function(error,interval){channel=App.data.getChannelById(program.id,true);App.data.requestProgramUrl({cid:channel.id,time:program.program_begin_time},function(error,uri){program.url=uri;Helper.removeClass("notifications-screen-container","loader");App.player.playProgram(channel,program)})})}}else{if(channel){App.player.playChannel(channel)}else{App.data.requestChannelList({icon_width:40,icon_height:40},function(error,interval){channel=App.data.getChannelById(program.id,true);App.player.playChannel(channel)})}}};this.key_down=function(){notificationsMenu.setNextItem()};this.key_up=function(){notificationsMenu.setPreviousItem()};this.key_back=function(){App.display.showScreen("account")};this.key_menu=function(){App.display.showScreen("mainmenu")};this.key_exit=function(){this.key_back()};this.key_backspace=function(){this.key_exit()};this.wheel=function(delta){if(delta>0){this.key_down()}else{this.key_up()}};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){var keys=[];if(menuItems.length>0){keys.push({action:"yellow",label:"label-delete-notification"})}keys.push({action:"back",label:"label-back"});App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("notifications");App.display.showPopupScreen("popup-key-panel")}else{this.key_enter()}}}_NotificationsScreen=new BaseScreen();NotificationsScreen.prototype=_NotificationsScreen;