function KeyboardScreen(){var that=this;var keyboardMenu=new BaseMenu({menuId:"keyboard-menu",menuTag:"ul",itemIdPrefix:"key",itemTag:"li",displayItemsNumber:11,sourceItemsNumber:11,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][0][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[0][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[0][index]==="1"){that.gotoMenu(index,0)}}});var keyboardMenu1=new BaseMenu({menuId:"keyboard-menu1",menuTag:"ul",itemIdPrefix:"one-key",itemTag:"li",displayItemsNumber:11,sourceItemsNumber:11,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][1][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[1][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[1][index]==="1"){that.gotoMenu(index,1)}}});var keyboardMenu2=new BaseMenu({menuId:"keyboard-menu2",menuTag:"ul",itemIdPrefix:"two-key",itemTag:"li",displayItemsNumber:11,sourceItemsNumber:11,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][2][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[2][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[2][index]==="1"){that.gotoMenu(index,2)}}});var keyboardMenu3=new BaseMenu({menuId:"keyboard-menu3",menuTag:"ul",itemIdPrefix:"three-key",itemTag:"li",displayItemsNumber:11,sourceItemsNumber:11,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][3][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[3][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[3][index]==="1"){that.gotoMenu(index,3)}}});var keyboardMenu4=new BaseMenu({menuId:"keyboard-menu4",menuTag:"ul",itemIdPrefix:"four-key",itemTag:"li",displayItemsNumber:1,sourceItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][4][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[4][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[4][index]==="1"){that.gotoMenu(index,4)}}});var keyboardMenu5=new BaseMenu({menuId:"keyboard-menu5",menuTag:"ul",itemIdPrefix:"five-key",itemTag:"li",displayItemsNumber:6,sourceItemsNumber:6,useFastRefresh:false,getItemNameFunc:function(sourceItemIndex,displayItemIndex){return keyboardModes[keyboardMode][5][sourceItemIndex]},onItemClick:function(index){if(currentMode.typing[5][index]==="1"){that.key_enter()}},onItemMouseOver:function(index){if(currentMode.typing[5][index]==="1"){that.gotoMenu(index,5)}}});var currentMenu=new BaseMenu();var callbackFunc=null;var curSym,keyboardMode,currentMenuIndex;var cursorPosition=0;var initialString="";var keyboardScreenId="keyboard-screen";var keyboardResultInputId="keyboard-result";var defaultTypingIndex=0;var KEYBOARD_MENUS=[keyboardMenu,keyboardMenu1,keyboardMenu2,keyboardMenu3,keyboardMenu4,keyboardMenu5];var UPR="↑";var LWR="↓";var LFT="&sub;";var RGT="&sup;";var OK="OK";var CLR="←";var SPC_RU="Пробел";var SPC_EN="Space";var RUS_KBD=[["1","2","3","4","5","6","7","8","9","0",CLR],["en","й","ц","у","к","е","н","г","ш","щ","з"],["#+","ф","ы","в","а","п","р","о","л","д","ж"],[UPR,"я","ч","с","м","и","т","б","э","ъ","ю"],[OK],["х","ь",SPC_RU,"-",LFT,RGT]];var ENG_KBD=[["1","2","3","4","5","6","7","8","9","0",CLR],["ru","q","w","e","r","t","y","u","i","o","p"],["#+","a","s","d","f","g","h","j","k","l","z"],[UPR,"x","c","v","b","n","m","@",".",",","_"],[OK],["!","?",SPC_EN,"-",LFT,RGT]];var SYMB_KBD=[["1","2","3","4","5","6","7","8","9","0",CLR],["!","@","#","%",":",".",",",";","(",")","~"],["$","+",'"','"',"#","-","^","&amp;","*","_","="],["§","'","\\","&lt;","|","&gt;","/","?","`","[","]"],[OK],["{","}",SPC_RU,"аб",LFT,RGT]];var SYMB_ENG_KBD=[["1","2","3","4","5","6","7","8","9","0",CLR],["!","@","#","%",":",".",",",";","(",")","~"],["$","+",'"','"',"#","-","^","&amp;","*","_","="],["§","'","\\","&lt;","|","&gt;","/","?","`","[","]"],[OK],["{","}",SPC_EN,"ab",LFT,RGT]];var RUS_UPPER_KBD=[],ENG_UPPER_KBD=[];var keyboardModes=[RUS_KBD,RUS_UPPER_KBD,SYMB_KBD,ENG_KBD,ENG_UPPER_KBD,SYMB_ENG_KBD];var MAP_ONLY_DIGITS=["11111111111","00000000000","00000000000","00000000000","1","000011"];var MAP_ONLY_LATINS=["00000000001","01111111111","01111111111","01111110100","1","001111"];var MAP_LATINS_AND_DIGITS=["11111111111","01111111111","01111111111","11111110000","1","001011"];var MAP_FULL_KEYBOARD=["11111111111","11111111111","11111111111","11111111111","1","111111"];var MAP_SERVICE_BUTTONS=["00000000001","00000000000","00000000000","00000000000","1","000011"];var MODE_FULL_KEYBOARD=0;var MODE_ONLY_DIGITS=1;var MODE_ONLY_UPPER_LATINS=2;var MODE_SERVICE_BUTTONS=3;var MODE_LATINS_AND_DIGITS=4;var typingMaps=[MAP_FULL_KEYBOARD,MAP_ONLY_DIGITS,MAP_ONLY_LATINS,MAP_SERVICE_BUTTONS,MAP_LATINS_AND_DIGITS];var typingClasses=["","only-digits","upper-latin","service","digits-letters"];var LOGIC_SIMPLE=0;var LOGIC_CARD_NUMBER=1;var LOGIC_LIMIT_BY_LENGTH=2;var LOGIC_LIMIT_BY_VALUE=3;var MAX_INPUT_LENGTH=32;var MAX_INPUT_VALUE=5000;var inputLogics=[LOGIC_SIMPLE,LOGIC_CARD_NUMBER,LOGIC_LIMIT_BY_LENGTH,LOGIC_LIMIT_BY_VALUE];var currentMode={typing:MAP_FULL_KEYBOARD,logic:LOGIC_SIMPLE,"max-length":MAX_INPUT_LENGTH,"max-value":MAX_INPUT_VALUE,"typing-index":0};this.setCallback=function(f){if(f instanceof Function){callbackFunc=f}for(var i=0;i<typingClasses.length;i++){Helper.removeClass(keyboardScreenId,typingClasses[i])}};this.setInitialString=function(str){initialString=str};this.setMaxInputLength=function(value){if(value){currentMode["max-length"]=value}else{currentMode["max-length"]=MAX_INPUT_LENGTH}};this.setMaxValue=function(value){currentMode["max-value"]=value};this.setCurrentMode=function(typing,logic,mode){for(var i=0;i<typingClasses.length;i++){Helper.removeClass(keyboardScreenId,typingClasses[i])}if(typing>0){Helper.addClass(keyboardScreenId,typingClasses[MODE_SERVICE_BUTTONS]);Helper.addClass(keyboardScreenId,typingClasses[typing])}currentMode["typing-index"]=typing;defaultTypingIndex=typing;currentMode.typing=typingMaps[typing];currentMode.logic=logic;keyboardMode=mode;if(typing===MODE_ONLY_UPPER_LATINS){currentMenuIndex=1;currentMenu=KEYBOARD_MENUS[currentMenuIndex];currentMenu.setSelectedItem(1,1)}else{currentMenuIndex=0;currentMenu=KEYBOARD_MENUS[currentMenuIndex];if(typing===MODE_SERVICE_BUTTONS){currentMenu.setSelectedItem(10,0)}else{currentMenu.setSelectedItem(0,0)}}this.changeMode()};this.show=function(inputId){if(RUS_UPPER_KBD.length===0){for(var i=0;i<RUS_KBD.length;i++){RUS_UPPER_KBD[i]=[];ENG_UPPER_KBD[i]=[];for(var j=0;j<RUS_KBD[i].length;j++){if(RUS_KBD[i][j].length===1&&RUS_KBD[i][j]>="а"&&RUS_KBD[i][j]<="я"){RUS_UPPER_KBD[i][j]=RUS_KBD[i][j].toUpperCase()}else{RUS_UPPER_KBD[i][j]=RUS_KBD[i][j]}if(ENG_KBD[i][j].length===1&&ENG_KBD[i][j]>="a"&&ENG_KBD[i][j]<="z"){ENG_UPPER_KBD[i][j]=ENG_KBD[i][j].toUpperCase()}else{ENG_UPPER_KBD[i][j]=ENG_KBD[i][j]}}}RUS_UPPER_KBD[3][0]=LWR;ENG_UPPER_KBD[3][0]=LWR}this.switchMode(inputId);curSym="|";if(Helper.byId(inputId)){initialString=Helper.getValue(inputId)}cursorPosition=initialString.length;Helper.setValue(keyboardResultInputId,initialString+curSym);App.playerScreen.hideTvInfoBar();App.playerScreen.hideVideoInfoBar();_KeyboardScreen.show()};this.init=function(){for(var i=1;i<KEYBOARD_MENUS.length;i++){KEYBOARD_MENUS[i].initEvents()}this.setOnHideCallback(function(){currentMode={typing:MAP_FULL_KEYBOARD,logic:LOGIC_SIMPLE,"max-length":MAX_INPUT_LENGTH,"max-value":MAX_INPUT_VALUE,"typing-index":0}});_KeyboardScreen.init()};this.hide=function(){keyboardMode=0;cursorPosition=0;initialString="";currentMenu.resetSelection();for(var i=0;i<typingClasses.length;i++){Helper.removeClass(keyboardScreenId,typingClasses[i])}_KeyboardScreen.hide()};this.switchMode=function(inputId){switch(inputId){case"card-holder":this.setCurrentMode(MODE_ONLY_UPPER_LATINS,LOGIC_SIMPLE,4);break;case"card-number":this.setCurrentMode(MODE_ONLY_DIGITS,LOGIC_CARD_NUMBER,0);break;case"card-cvc":case"signup-phone-number":this.setCurrentMode(MODE_ONLY_DIGITS,LOGIC_SIMPLE,0);break;case"amount-value":this.setCurrentMode(MODE_ONLY_DIGITS,LOGIC_LIMIT_BY_VALUE,0);break;case"login-abonement":if(App.clientSettings.is_letters_in_login){this.setCurrentMode(MODE_LATINS_AND_DIGITS,LOGIC_SIMPLE,3)}else{this.setCurrentMode(MODE_ONLY_DIGITS,LOGIC_SIMPLE,0)}break;case"login-password":case"parent-code-number":if(App.clientSettings.is_letters_in_password){this.setCurrentMode(MODE_LATINS_AND_DIGITS,LOGIC_SIMPLE,3)}else{this.setCurrentMode(MODE_ONLY_DIGITS,LOGIC_SIMPLE,0)}break;default:this.setCurrentMode(MODE_FULL_KEYBOARD,LOGIC_SIMPLE,0);break}};this.gotoMenu=function(itemIndex,menuIndex){if(menuIndex!=null){currentMenuIndex=menuIndex}currentMenu.resetSelection();currentMenu=KEYBOARD_MENUS[currentMenuIndex];currentMenu.setSelectedItem(itemIndex,itemIndex)};this.changeMode=function(){var itemIndex=currentMenu.getSelectedDisplayItem();for(var i=1;i<KEYBOARD_MENUS.length;i++){KEYBOARD_MENUS[i].redrawMenuItems();KEYBOARD_MENUS[i].resetSelection()}currentMenu.setSelectedItem(itemIndex,itemIndex)};this.getNextMenuIndex=function(itemIndex,typingArray){var nextMenuIndex=-1;for(var i=0;i<typingArray.length;i++){var index=currentMode.typing[typingArray[i]].indexOf("1");if(index!==-1){nextMenuIndex=typingArray[i];return nextMenuIndex}}return nextMenuIndex};this.getNextItemIndex=function(itemIndex,nextMenuIndex){var typingArray=currentMode.typing[nextMenuIndex];var nearestLeftItem=typingArray.substring(0,itemIndex).lastIndexOf("1");var nearestRightItem=typingArray.substring(itemIndex).indexOf("1");if(nearestLeftItem===-1){return nearestRightItem+itemIndex}if(nearestRightItem===-1){return nearestLeftItem}else{nearestRightItem+=itemIndex}var leftDiff=Math.abs(itemIndex-nearestLeftItem);var rightDiff=Math.abs(itemIndex-nearestRightItem);if(leftDiff<=rightDiff){return nearestLeftItem}else{return nearestRightItem}};this.handleKeyboardSystemButton=function(tmp){var sym=keyboardModes[keyboardMode][currentMenuIndex][currentMenu.getSelectedDisplayItem()];switch(sym){case CLR:this.key_backspace();break;case SPC_RU:case SPC_EN:Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition)+" "+tmp.substring(cursorPosition,tmp.length));cursorPosition++;break;case OK:if(callbackFunc instanceof Function){callbackFunc(tmp.substring(0,cursorPosition)+tmp.substring(cursorPosition+1,tmp.length))}this.hide();break;case UPR:keyboardMode++;this.changeMode();break;case LWR:keyboardMode--;this.changeMode();break;case"en":keyboardMode=3;this.changeMode();break;case"ru":keyboardMode=0;this.changeMode();break;case"#+":if(keyboardMode===0||keyboardMode===1){keyboardMode=2}else{keyboardMode=5}this.changeMode();break;case"ab":keyboardMode-=2;this.changeMode();break;case"аб":keyboardMode-=2;this.changeMode();break;case LFT:if(cursorPosition>0){Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition-1)+curSym+tmp[cursorPosition-1]+tmp.substring(cursorPosition+1,tmp.length));cursorPosition--}break;case RGT:if(cursorPosition!==tmp.length-1){Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition)+tmp[cursorPosition+1]+curSym+tmp.substring(cursorPosition+2,tmp.length));cursorPosition++}break;default:switch(sym){case"&lt;":sym="<";break;case"&gt;":sym=">";break;case"&amp;":sym="&";break;default:break}Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition)+sym+tmp.substring(cursorPosition,tmp.length));cursorPosition++;break}return Helper.getValue(keyboardResultInputId)};this.handleKeyboardButton=function(tmp,str){if(tmp.length<=currentMode["max-length"]){if(str==null){tmp=this.handleKeyboardSystemButton(tmp)}else{Helper.setValue(keyboardResultInputId,str);cursorPosition++;tmp=Helper.getValue(keyboardResultInputId)}if(tmp.length>=currentMode["max-length"]+1&&currentMode["typing-index"]!==MODE_SERVICE_BUTTONS){Helper.removeClass(keyboardScreenId,typingClasses[currentMode["typing-index"]]);currentMode["typing-index"]=MODE_SERVICE_BUTTONS;currentMode.typing=MAP_SERVICE_BUTTONS;this.gotoMenu(10,0);Helper.addClass(keyboardScreenId,typingClasses[currentMode["typing-index"]])}}else{tmp=this.handleKeyboardSystemButton(tmp);if(tmp.length<=currentMode["max-length"]){if(defaultTypingIndex===0){Helper.removeClass(keyboardScreenId,typingClasses[currentMode["typing-index"]])}currentMode["typing-index"]=defaultTypingIndex;currentMode.typing=typingMaps[defaultTypingIndex];Helper.addClass(keyboardScreenId,typingClasses[currentMode["typing-index"]])}}};this.key_back=function(){this.hide()};this.key_right=function(){var currentItemIndex=currentMenu.getSelectedDisplayItem();var typingArray=currentMode.typing;var nextItemIndex=currentItemIndex;if(currentMenuIndex===4){nextItemIndex=typingArray[2].indexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,2)}}else{nextItemIndex=typingArray[currentMenuIndex].indexOf("1",currentItemIndex+1);if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,currentMenuIndex)}else{if(currentMenuIndex>0&&currentMenuIndex<4){if(typingArray[4][0]==="1"){this.gotoMenu(0,4)}}else{if(currentMenuIndex===0||currentMenuIndex===5){nextItemIndex=typingArray[currentMenuIndex].indexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,currentMenuIndex)}}}}}};this.key_left=function(){var currentItemIndex=currentMenu.getSelectedDisplayItem();var typingArray=currentMode.typing;var nextItemIndex=currentItemIndex;if(currentMenuIndex===4){nextItemIndex=typingArray[2].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,2)}}else{if(currentMenuIndex>0&&currentMenuIndex<4&&currentItemIndex===0){this.gotoMenu(0,4)}else{nextItemIndex=typingArray[currentMenuIndex].lastIndexOf("1",(currentItemIndex+typingArray[currentMenuIndex].length-1)%typingArray[currentMenuIndex].length);if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,currentMenuIndex)}else{if(currentMenuIndex>0&&currentMenuIndex<4){if(typingArray[4][0]==="1"){this.gotoMenu(0,4)}}else{if(currentMenuIndex===0||currentMenuIndex===5){nextItemIndex=typingArray[currentMenuIndex].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,currentMenuIndex)}}}}}}};this.key_up=function(){var currentItemIndex=currentMenu.getSelectedDisplayItem();var typingArray=currentMode.typing;var nextItemIndex=currentItemIndex,nextMenuIndex=currentMenuIndex;switch(currentMenuIndex){case 4:nextItemIndex=typingArray[0].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,0)}else{nextItemIndex=typingArray[5].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,5)}}break;case 5:if(currentItemIndex===5){this.gotoMenu(0,4)}else{nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[3,4,2,1,0]);if(nextMenuIndex===4){this.gotoMenu(0,4)}else{switch(currentItemIndex){case 0:case 1:if(nextMenuIndex===3||typingArray[nextMenuIndex][currentItemIndex]==="1"){nextItemIndex=currentItemIndex}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}break;case 2:if(nextMenuIndex===3&&typingArray[nextMenuIndex][5]==="1"){nextItemIndex=5}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}break;case 3:case 4:if(nextMenuIndex===3&&typingArray[nextMenuIndex][currentItemIndex+6]==="1"){nextItemIndex=currentItemIndex+6}else{nextItemIndex=this.getNextItemIndex(currentItemIndex+6,nextMenuIndex)}break}this.gotoMenu(nextItemIndex,nextMenuIndex)}}break;case 0:if(currentItemIndex!==10){nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[5,3,4,2,1]);if(nextMenuIndex===5){if(currentItemIndex>1&&currentItemIndex<9){if(typingArray[nextMenuIndex][2]==="1"){nextItemIndex=2}else{nextItemIndex=typingArray[nextMenuIndex].indexOf("1")}}else{if(currentItemIndex<2){nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}else{nextItemIndex=this.getNextItemIndex(currentItemIndex-6,nextMenuIndex)}}}this.gotoMenu(nextItemIndex,nextMenuIndex)}else{this.gotoMenu(5,5)}break;default:switch(currentMenuIndex){case 3:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[2,1,0,5,4]);break;case 2:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[1,0,5,4,3]);break;case 1:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[0,5,4,3,2]);break}if(nextMenuIndex===4){this.gotoMenu(0,4)}else{if(nextMenuIndex===5){nextItemIndex=2}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}this.gotoMenu(nextItemIndex,nextMenuIndex)}break}};this.key_down=function(){var currentItemIndex=currentMenu.getSelectedDisplayItem();var typingArray=currentMode.typing;var nextItemIndex=currentItemIndex,nextMenuIndex=currentMenuIndex;switch(currentMenuIndex){case 4:nextItemIndex=typingArray[5].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,5)}else{nextItemIndex=typingArray[0].lastIndexOf("1");if(nextItemIndex!==-1){this.gotoMenu(nextItemIndex,0)}}break;case 5:if(currentItemIndex===5||currentItemIndex===4){this.gotoMenu(10,0)}else{nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[0,1,4,2,3]);if(nextMenuIndex===4){this.gotoMenu(0,4)}else{switch(currentItemIndex){case 0:case 1:nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex);break;case 2:if(typingArray[nextMenuIndex][5]==="1"){nextItemIndex=5}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}break;case 3:if(typingArray[nextMenuIndex][currentItemIndex+6]==="1"){nextItemIndex=currentItemIndex+6}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}break}this.gotoMenu(nextItemIndex,nextMenuIndex)}}break;case 0:if(currentItemIndex!==10){nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[1,4,2,3,5]);if(nextMenuIndex===4){this.gotoMenu(0,4)}else{if(nextMenuIndex===5){nextItemIndex=2}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}this.gotoMenu(nextItemIndex,nextMenuIndex)}}else{this.gotoMenu(0,4)}break;default:switch(currentMenuIndex){case 3:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[5,0,1,4,2]);break;case 2:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[3,5,0,1,4]);break;case 1:nextMenuIndex=this.getNextMenuIndex(currentMenuIndex,[2,3,5,0,4]);break}if(nextMenuIndex===4){this.gotoMenu(0,4)}else{if(nextMenuIndex===5&&currentItemIndex>1){if(currentItemIndex<9){nextItemIndex=2}else{if(nextItemIndex===0){nextItemIndex=10}else{nextItemIndex=this.getNextItemIndex(currentItemIndex-6,nextMenuIndex)}}}else{nextItemIndex=this.getNextItemIndex(currentItemIndex,nextMenuIndex)}this.gotoMenu(nextItemIndex,nextMenuIndex)}break}};this.key_backspace=function(){var tmp=Helper.getValue(keyboardResultInputId);if(cursorPosition>0){Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition-1)+tmp.substring(cursorPosition,tmp.length));cursorPosition--}};this.key_digit=function(digit){var tmp=Helper.getValue(keyboardResultInputId);var str=tmp.substring(0,cursorPosition)+digit+tmp.substring(cursorPosition,tmp.length);if(currentMode["typing-index"]!==MODE_ONLY_UPPER_LATINS){switch(currentMode.logic){case LOGIC_CARD_NUMBER:if(tmp.length!==0&&tmp.length%5===0&&keyboardModes[keyboardMode][currentMenuIndex][currentMenu.getSelectedDisplayItem()]!==CLR){Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition)+" "+tmp.substring(cursorPosition,tmp.length));cursorPosition++;tmp=Helper.getValue(keyboardResultInputId)}str=tmp.substring(0,cursorPosition)+digit+tmp.substring(cursorPosition,tmp.length);this.handleKeyboardButton(tmp,str);break;case LOGIC_LIMIT_BY_VALUE:var val=parseInt(str.substring(0,cursorPosition+1)+str.substring(cursorPosition+2,str.length));if(val<=currentMode["max-value"]){this.handleKeyboardButton(tmp,str)}break;default:this.handleKeyboardButton(tmp,str);break}}};this.key_enter=function(){var tmp=Helper.getValue(keyboardResultInputId);switch(currentMode.logic){case LOGIC_CARD_NUMBER:if(tmp.length!==0&&tmp.length%5===0&&keyboardModes[keyboardMode][currentMenuIndex][currentMenu.getSelectedDisplayItem()]!==CLR){Helper.setValue(keyboardResultInputId,tmp.substring(0,cursorPosition)+" "+tmp.substring(cursorPosition,tmp.length));cursorPosition++;tmp=Helper.getValue(keyboardResultInputId)}this.handleKeyboardButton(tmp);break;case LOGIC_LIMIT_BY_VALUE:var sym=keyboardModes[keyboardMode][currentMenuIndex][currentMenu.getSelectedDisplayItem()];var val=tmp.substring(0,cursorPosition)+sym+tmp.substring(cursorPosition,tmp.length);if(parseInt(val)<=currentMode["max-value"]){this.handleKeyboardButton(tmp)}break;default:this.handleKeyboardButton(tmp);break}};this.key_exit=function(){if(Device.getDeviceKind()==="eltex"){this.key_backspace()}else{this.key_back()}};this.wheel=function(delta){return true}}_KeyboardScreen=new BaseScreen();KeyboardScreen.prototype=_KeyboardScreen;