function LoginScreen(){var abonementId="login-abonement";var passwordId="login-password";var buttonId="login-button";var history=0;var messageShowed=false;var that=this;var loginMenu=new BaseMenu({menuId:"login-menu",menuTag:"ul",itemIdPrefix:"loginmenu",itemTag:"li",displayItemsNumber:3,sourceItemsNumber:3,onItemClick:function(index){if(loginMenu.getSelectedDisplayItem()===2){that.key_enter()}else{that.key_right()}},onItemMouseOver:function(index){loginMenu.setSelectedItem(index,index)}});this.getAbonementId=function(){return abonementId};this.setAbonementId=function(value){abonementId=value};this.getPasswordId=function(){return passwordId};this.setPasswordId=function(value){passwordId=value};this.init=function(){_LoginScreen.init()};this.show=function(){if(!App.clientSettings.registration_available){Helper.hideById("login-registration-icon")}App.playerScreen.hideTvInfoBar();App.playerScreen.hideVideoInfoBar();Helper.setValue(abonementId,App.settings.getAbonement());Helper.setValue(passwordId,App.settings.getPassword());App.popupListScreen.hide();App.popupGenresScreen.hide();history=0;this.loginAttempt()};this.loginAttempt=function(){if(!this.key_enter()){history=1;loginMenu.setSelectedItem(0,0);_LoginScreen.show();if(!messageShowed){messageShowed=true;if(App.clientSettings.show_welcome_message&&App.clientSettings.welcome_message){if(!App.settings.getAbonement()){App.popupMessageScreen.setMessageText(App.clientSettings.welcome_message);App.display.showPopupScreen("popup-message")}}}}};this.askToExit=function(message,callback){App.popupMessageScreen.setMessageText(App.lang.get(message),App.popupMessageScreen.MODE_CHOICE);App.popupMessageScreen.setCallback(callback);App.display.showPopupScreen("popup-message")};this.getInputSelectedId=function(){var id="";if(loginMenu.getSelectedDisplayItem()===0){id=abonementId}else{if(loginMenu.getSelectedDisplayItem()===1){id=passwordId}else{id=buttonId}}return id};this.key_down=function(){loginMenu.setNextItem()};this.key_up=function(){loginMenu.setPreviousItem()};this.key_digit=function(digit){var id=this.getInputSelectedId();if(Helper.getValue(id).length<11){Helper.setValue(id,Helper.getValue(id)+digit)}};this.key_back=function(){this.askToExit("app-close-question-msg",function(value){if(value){App.settings.setClientId(-1);App.settings.saveSettings();App.player.stop();App.device.exitToPortal()}})};this.key_backspace=function(){var id=this.getInputSelectedId();var value=Helper.getValue(id);if(value.length>0){value=value.substr(0,value.length-1);Helper.setValue(id,value)}};this.key_left=function(){this.key_backspace()};this.key_right=function(){var id=this.getInputSelectedId();App.keyboardScreen.setMaxInputLength(11);App.keyboardScreen.setCallback(function(str){Helper.setValue(id,str)});App.display.showPopupScreen("keyboard",id)};this.key_enter=function(){var id=this.getInputSelectedId();var tryLogin=false;if(history===0){tryLogin=true}if(id===buttonId){tryLogin=true}if(id===abonementId&&Helper.getValue(abonementId)!==""){tryLogin=true}if(id===passwordId&&Helper.getValue(passwordId)!==""){tryLogin=true}if((App.clientSettings.auth_mode==="device_uid"||App.clientSettings.auth_mode==="device_uid_wo_fallback")&&App.device.getDeviceUID()){tryLogin=true}if(tryLogin){App.settings.setAbonement(Helper.getValue(abonementId));App.settings.setPassword(Helper.getValue(passwordId));if((App.clientSettings.auth_mode==="device_uid"||App.clientSettings.auth_mode==="device_uid_wo_fallback")&&App.device.getDeviceUID()){App.clientSettings.auth_mode=""}else{if(!App.settings.getAbonement()){this.key_up();return false}if(!App.settings.getPassword()){this.key_down();return false}}Helper.addClass("login-screen-container","loader");App.data.requestLogin({abonement:App.settings.getAbonement(),password:App.settings.getPassword(),device_uid:App.device.getDeviceUID(),device_model:App.device.getDeviceModel()},function(error){Helper.removeClass("login-screen-container","loader");if(error==0){var resetSettings=App.data.getResetSettings();if(resetSettings&&history===0){App.settings.clearSettings();App.reloadToTemplate((App.clientSettings.template_name));return}App.settings.saveSettings();App.resetAccountTemplate();if(App.data.getTemplate()){App.setAccountTemplate(App.data.getTemplate())}App.infoScreen.setName(App.data.getFirstname()+" "+App.data.getLastname());App.infoScreen.setAccountId(App.settings.getAbonement());App.infoScreen.setIpAddress(App.data.getIpAddress());App.infoScreen.setContractNumber(App.data.getContractNumber());App.infoScreen.setActivationDaysLeft(App.data.getActivationDaysLeft());App.infoScreen.setMiddlewareVersion(App.data.getBackendName()+" v. "+App.data.getBackendVersion());App.refreshNotifications(function(){App.checkNotifications()});App.data.requestApplicationList({},function(error){if(error==0){var redrawMainMenu=false;var redrawAppsMenu=false;App.display.clearApplicationList();var n=App.data.getNumberOfApplications();for(var i=0;i<n;i++){var application=App.data.getApplication(i);try{var applicationInstance=new BaseApplication();applicationInstance.setDataIndex(i);applicationInstance.setAttrs(application.attrs);applicationInstance.init();applicationInstance.setVideoCatalogScreenName("videocatalog");applicationInstance.setTVScreenName("tvchannels");applicationInstance.setBlankScreenName("blank");App.display.addApplication(applicationInstance,application.system_name);if(!application.show_in_main_menu){App.appsScreen.addMenuItem(application.name,application.system_name,application,application.icon,application.icon_focus);redrawAppsMenu=true}}catch(e){alert(e)}if(application.show_in_main_menu&&application.type!=4){App.mainmenuScreen.addMenuItem(application.name,application.system_name,3,application.css_style);redrawMainMenu=true}}if(redrawAppsMenu){if(!App.mainmenuScreen.checkMenuItemActionExists("apps")){App.mainmenuScreen.addMenuItem(App.lang.get("label-mainmenu-apps"),"apps",4);redrawMainMenu=true}App.appsScreen.generateAppsMenu()}if(redrawMainMenu){App.mainmenuScreen.generateMainMenu()}}else{}});if(App.clientSettings.auth_mode!=="device_uid"&&App.clientSettings.auth_mode!=="device_uid_wo_fallback"){App.settings.setAbonement(App.settings.getAbonement());App.settings.setPassword(App.settings.getPassword());App.settings.setClientId(App.data.getClientId());App.settings.setApiKey(App.data.getApiKey());App.settings.setApiUrl(App.data.getApiUrl());App.settings.saveSettings()}App.fireEvent(App.EVENT_ON_ACCOUNT_LOGIN_SUCCESSFUL);if(App.data.getLastChannel()>=0&&App.settings.getAutoLaunchPlayer()==1){App.tvChannelsScreen.setCheckLastChannel(true);App.display.showScreen("tvchannels")}else{App.display.showScreen("mainmenu")}}else{App.settings.setPassword("");App.clientSettings.auth_mode="password";App.display.showScreen("login");var s="";switch(parseInt(error)){default:if(App.device.getNetworkLinkStatus()){s=App.lang.get("login-unknown-error")}else{s=App.lang.get("connection-failed-msg")}break;case 1:s=App.lang.get("account-not-found-msg");break;case 2:if(App.clientSettings.account_renewal_message){s=App.clientSettings.account_renewal_message}else{s=App.lang.get("account-not-active-msg")}break;case 3:s=App.lang.get("login-server-error-msg")+" Error code: 3";break;case 4:s=App.lang.get("login-server-error-msg")+" Error code: 4";break;case 5:s=App.lang.get("basic-sessions-limit-is-exceeded-msg");break;case 6:s=App.lang.get("account-already-used-on-other-basic-device-msg");break;case 7:s=App.lang.get("login-server-error-msg")+" Error code: 7";break;case 8:s=App.lang.get("no-tarrifs-error-msg");if(App.clientSettings.site_url!=="www.example.com"){s+=" "+App.clientSettings.site_url}else{s+="."}break;case 9:s=App.lang.get("from-current-ip-login-is-now-allowed-error-msg");break;case 15:s=App.lang.get("this-device-type-is-not-activated-on-your-account-msg");break}if(error>1||App.settings.getAbonement()!=""){App.popupMessageScreen.setMessageText(s);App.display.showPopupScreen("popup-message")}}})}return true};this.key_red=function(){if(App.clientSettings.registration_available){App.display.showScreen("signup")}};this.key_power=function(){App.switchStandBy()};this.key_exit=function(){if(Device.getDeviceKind()==="eltex"){this.key_backspace()}else{this.askToExit("app-close-question-msg",function(value){if(value){App.device.exitToPortal()}})}};this.wheel=function(){return true};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){if(App.clientSettings.registration_available){var keys=[{action:"red",label:"label-signup"}];App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("login");App.display.showPopupScreen("popup-key-panel")}}else{this.key_enter()}}}_LoginScreen=new BaseScreen();LoginScreen.prototype=_LoginScreen;