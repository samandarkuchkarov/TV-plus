function SettingsScreen(){var that=this;var settingsMenu=new BaseMenu({menuId:"settings-menu",menuTag:"ul",itemIdPrefix:"settings",itemTag:"li",displayItemsNumber:8,sourceItemsNumber:8,useFastRefresh:true,getItemNameFunc:function(realItemIndex,itemIndex,node){if(settingsList.length>realItemIndex){if(!node){return true}else{var key=settingsList[realItemIndex]["action"];var isRedirect=settingsList[realItemIndex]["is_redirect"];var keyElement=document.createElement("div");keyElement.setAttribute("class","key label-settings-"+key);keyElement.innerHTML=App.lang.get("label-settings-"+key);node.appendChild(keyElement);if(!isRedirect){var valueElement=document.createElement("div");valueElement.setAttribute("class","value");var leftButtonElement=document.createElement("div");leftButtonElement.setAttribute("class","remote-button left key-handler");leftButtonElement.setAttribute("x-key-handler","left");var keyValueElement=document.createElement("span");keyValueElement.setAttribute("id","settings-"+key+"-value");var rightButtonElement=document.createElement("div");rightButtonElement.setAttribute("class","remote-button right key-handler");rightButtonElement.setAttribute("x-key-handler","right");valueElement.appendChild(leftButtonElement);valueElement.appendChild(keyValueElement);valueElement.appendChild(rightButtonElement);node.appendChild(valueElement)}}}else{return""}},onItemClick:function(index){that.key_enter()},onItemMouseOver:function(index){settingsMenu.setSelectedItem(index,index)}});var settingsLangMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-lang-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var values=App.settings.getLangValues();return values[realItemIndex][0]}});var settingsBufferSizeMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-buffersize-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var names=["label-buffersize-auto","label-buffersize-none","label-buffersize-small","label-buffersize-medium","label-buffersize-big","label-buffersize-verybig"];return'<span class="'+names[realItemIndex]+'">'+App.lang.get(names[realItemIndex])+"</span>"}});var settingsTimezoneMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-timezone-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var values=App.settings.getTimezoneValues();return values[realItemIndex][0]}});var settingsTemplateStyleMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-template-style-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var value=App.settings.getTemplateStyleList()[realItemIndex];return'<span class="label-style-'+value+'">'+App.lang.get("label-style-"+value)+"</span>"}});var settingsUseTimeshiftMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-use-timeshift-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var names=["label-use-timeshift-off","label-use-timeshift-on"];return'<span class="'+names[realItemIndex]+'">'+App.lang.get(names[realItemIndex])+"</span>"}});var settingsAutoLaunchPlayerMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-auto-launch-player-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var names=["label-refuse","label-agree"];return'<span class="'+names[realItemIndex]+'">'+App.lang.get(names[realItemIndex])+"</span>"}});var settingsNotificationTimeMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-notification-time-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var names=App.settings.getNotificationTimeValues();return names[realItemIndex][1]/60+'<span class="label-minutes">'+App.lang.get("label-minutes")+"</span>"}});var settingsShowPreviewPlayerMenu=new BaseMenu({menuTag:"ul",itemIdPrefix:"settings-show-preview-player-value",useItemIdWithoutIndex:true,itemTag:"span",displayItemsNumber:1,useFastRefresh:false,getItemNameFunc:function(realItemIndex,itemIndex){var names=["label-refuse","label-agree"];return'<span class="'+names[realItemIndex]+'">'+App.lang.get(names[realItemIndex])+"</span>"}});var customSettingsMenus=[];var timeSettingsChanged=false;var langSettingsChanged=false;var styleSettingsChanged=false;var bufferSizeSettingsChanged=false;var autoLaunchPlayerChanged=false;var useTimeshiftSettingsChanged=false;var customSettingsChanged=false;var notificationTimeChanged=false;var showPreviewPlayerSettingsChanged=false;var settingsList=[];var timeInterval=null;this.addItemToSettingsList=function(action,isRedirect){settingsList.push({action:action,is_redirect:isRedirect?true:false})};this.addCustomSettingsMenu=function(key,menu){if(menu instanceof BaseMenu){customSettingsMenus[key]=menu}};this.isSettingsChanged=function(){return(timeSettingsChanged||langSettingsChanged||styleSettingsChanged||useTimeshiftSettingsChanged||bufferSizeSettingsChanged||customSettingsChanged||autoLaunchPlayerChanged||notificationTimeChanged||showPreviewPlayerSettingsChanged)};this.show=function(){App.playerScreen.hideTvInfoBar();App.playerScreen.hideVideoInfoBar();Helper.showById("tvchannels-clock");_SettingsScreen.show();if(!timeInterval){this.refreshDisplayTime();timeInterval=setInterval(that.refreshDisplayTime,15000)}timeSettingsChanged=false;langSettingsChanged=false;styleSettingsChanged=false;autoLaunchPlayerChanged=false;useTimeshiftSettingsChanged=false;customSettingsChanged=false;notificationTimeChanged=false;showPreviewPlayerSettingsChanged=false};this.refresh=function(){settingsMenu.redrawMenuItems();settingsLangMenu.redrawMenuItems();settingsBufferSizeMenu.redrawMenuItems();settingsTimezoneMenu.redrawMenuItems();settingsTemplateStyleMenu.redrawMenuItems();settingsUseTimeshiftMenu.redrawMenuItems();settingsAutoLaunchPlayerMenu.redrawMenuItems();settingsNotificationTimeMenu.redrawMenuItems();settingsShowPreviewPlayerMenu.redrawMenuItems();Helper.showById("settings-clock");for(var i in customSettingsMenus){try{if(customSettingsMenus[i] instanceof BaseMenu){customSettingsMenus[i].redrawMenuItems()}}catch(e){}}_SettingsScreen.init()};this.init=function(){this.addItemToSettingsList("buffersize");this.addItemToSettingsList("timezone");this.addItemToSettingsList("auto-launch-player");this.addItemToSettingsList("notification-time");if(App.device.isDeviceSupportSetPlayerSize()){this.addItemToSettingsList("show-preview-player")}if(App.clientSettings.template_styles["impuls"]){if(App.clientSettings.template_styles["impuls"].length>0){this.addItemToSettingsList("template-style")}}for(var i in App.clientSettings.settings_menu_custom_items){this.addItemToSettingsList(App.clientSettings.settings_menu_custom_items[i])}if(App.clientSettings.show_sort_screen){this.addItemToSettingsList("channels-sort",true)}if(App.device.getDeviceKind()==="android_stb"&&App.clientSettings.show_udp_proxy_settings){this.addItemToSettingsList("udp",true)}settingsMenu.setNumberOfDisplayItems(settingsList.length);settingsMenu.setNumberOfSourceItems(settingsList.length);settingsMenu.redrawMenuItems();settingsMenu.resetSelection();settingsMenu.setSelectedItem(0,0);this.loadSettingsValues();_SettingsScreen.init();if(App.device.getDeviceKind()==="amino"){this._key_menu=this.key_menu;this.key_menu=function(){this.showSaveDialog(this._key_menu)};this._key_exit=this.key_exit;this.key_exit=function(){this.showSaveDialog(this._key_exit)}}};this.switchSettingsValue=function(d){var valuesMenu=null;var key=settingsMenu.getSelectedDisplayItem();if(settingsList.length>key){key=settingsList[key]["action"]}switch(key){case"timezone":valuesMenu=settingsTimezoneMenu;if(d===-1||d===1){timeSettingsChanged=true}break;case"buffersize":valuesMenu=settingsBufferSizeMenu;if(d===-1||d===1){bufferSizeSettingsChanged=true}break;case"lang":valuesMenu=settingsLangMenu;if(d===-1||d===1){langSettingsChanged=true}break;case"template-style":if(App.settings.getNumberOfStyleTemplates()>1){valuesMenu=settingsTemplateStyleMenu;if(d===-1||d===1){styleSettingsChanged=true}}else{App.popupMessageScreen.setMessageText(App.lang.get("settings-only-one-style-msg"));App.display.showPopupScreen("popup-message")}break;case"use-timeshift":valuesMenu=settingsUseTimeshiftMenu;if(d===-1||d===1){useTimeshiftSettingsChanged=true}break;case"auto-launch-player":valuesMenu=settingsAutoLaunchPlayerMenu;if(d===-1||d===1){autoLaunchPlayerChanged=true}break;case"notification-time":valuesMenu=settingsNotificationTimeMenu;if(d===-1||d===1){notificationTimeChanged=true}break;case"show-preview-player":valuesMenu=settingsShowPreviewPlayerMenu;if(d===-1||d===1){showPreviewPlayerSettingsChanged=true}break;default:if(key in customSettingsMenus){valuesMenu=customSettingsMenus[key];if(d===-1||d===1){customSettingsChanged=true}}break}if(valuesMenu){var prevInd=valuesMenu.getSelectedSourceItem();if(d===-1){valuesMenu.setPreviousItem()}else{if(d===1){valuesMenu.setNextItem()}}valuesMenu.redrawMenuItems();if(App.device.getDeviceKind()!=="amino"){this.saveSettingsValues(prevInd)}}};this.loadSettingsValues=function(){function loadSettingsValuesMenu(valuesMenu,value,len){valuesMenu.clear();valuesMenu.setNumberOfDisplayItems(1);valuesMenu.setNumberOfSourceItems(len);valuesMenu.setSelectedItem(0,value);valuesMenu.redrawMenuItems()}loadSettingsValuesMenu(settingsLangMenu,App.settings.getLang(),App.settings.getLangValues().length);loadSettingsValuesMenu(settingsTimezoneMenu,App.settings.getTimezone(),App.settings.getTimezoneValues().length);loadSettingsValuesMenu(settingsBufferSizeMenu,App.settings.getBufferSize(),App.settings.getBufferSizeValues().length);loadSettingsValuesMenu(settingsAutoLaunchPlayerMenu,App.settings.getAutoLaunchPlayer(),App.settings.getAutoLaunchPlayerValues().length);loadSettingsValuesMenu(settingsTemplateStyleMenu,App.settings.getStyle(),App.settings.getNumberOfStyleTemplates());loadSettingsValuesMenu(settingsUseTimeshiftMenu,App.data.getUseTimeshift()?1:0,2);loadSettingsValuesMenu(settingsNotificationTimeMenu,App.settings.getNotificationTime(),App.settings.getNumberOfNotificationTimeValues());loadSettingsValuesMenu(settingsShowPreviewPlayerMenu,App.settings.getShowPreviewPlayer()?1:0,App.settings.getShowPreviewPlayerValues().length);for(var i in customSettingsMenus){try{if(customSettingsMenus[i] instanceof BaseMenu){customSettingsMenus[i].setSelectedItem(0,App.settings.getCustomSetting(i));customSettingsMenus[i].redrawMenuItems()}}catch(e){}}};this.saveSettingsValues=function(){for(var i in customSettingsMenus){try{if(customSettingsMenus[i] instanceof BaseMenu){App.settings.setCustomSetting(i,customSettingsMenus[i].getSelectedSourceItem())}}catch(e){}}App.settings.setLang(settingsLangMenu.getSelectedSourceItem());App.settings.setTimezone(settingsTimezoneMenu.getSelectedSourceItem());App.settings.setBufferSize(settingsBufferSizeMenu.getSelectedSourceItem());App.settings.setTemplateStyle(settingsTemplateStyleMenu.getSelectedSourceItem());App.settings.setAutoLaunchPlayer(settingsAutoLaunchPlayerMenu.getSelectedSourceItem());App.settings.setNotificationTime(settingsNotificationTimeMenu.getSelectedSourceItem());App.settings.setShowPreviewPlayer(settingsShowPreviewPlayerMenu.getSelectedSourceItem());App.settings.saveSettings();if(timeSettingsChanged){App.tvChannelsScreen.refresh();App.epgScreen.refresh();App.playerScreen.refresh();App.categorizedTVScreen.refresh();App.settingsScreen.refreshDisplayTime();timeSettingsChanged=false}if(langSettingsChanged){App.lang.reload();if(App.categorizedTVScreen.getInited()){App.categorizedTVScreen.init()}if(App.videoCatalogScreen.getInited()){App.videoCatalogScreen.init()}if(App.tvChannelsScreen.getInited()){App.tvChannelsScreen.init()}App.settings.setReferenceShownFlag(false);App.settings.saveSettings();this.refreshDisplayTime();langSettingsChanged=false}if(styleSettingsChanged){Helper.addClass("settings-screen-container","loader");settingsMenu.resetSelection();App.settings.setTemplateStyleCSS(function(){styleSettingsChanged=false;App.mainmenuScreen.generateMainMenu();App.tvChannelsScreen.refresh();if(App.tvChannelsScreen.getInited()){App.tvChannelsScreen.filterChannelListByCategory()}App.categorizedTVScreen.refresh();App.categorizedTVScreen.setInited(false);App.settingsScreen.refresh();settingsMenu.setSelectedItem(4,4);Helper.removeClass("settings-screen-container","loader")})}if(useTimeshiftSettingsChanged){App.data.setUseTimeshift(settingsUseTimeshiftMenu.getSelectedSourceItem()===1);App.popupMessageScreen.setMessageText(App.lang.get("device-go-to-reloading-msg"));App.display.showPopupScreen("popup-message");App.data.requestSettingsSaveUseTimeshift([],function(){useTimeshiftSettingsChanged=false;setTimeout(App.device.reload,2000)})}if(notificationTimeChanged){clearTimeout(App.notificationTimer);App.notificationTimer=setTimeout(function(){App.checkNotifications()},30000)}if(showPreviewPlayerSettingsChanged){App.settings.getShowPreviewPlayer()?App.tvChannelsScreen.setPlayerMode():App.tvChannelsScreen.resetPlayerMode()}};this.refreshDisplayTime=function(){var now=Helper.withTimezone(App.data.getUtcTime());var d=new Date(now*1000);var date=("0"+d.getDate()).substr(-2,2)+" "+App.lang.get("month-"+d.getMonth())+" "+d.getFullYear();var timeStr=("0"+d.getHours()).substr(-2,2)+":"+("0"+d.getMinutes()).substr(-2,2);Helper.setHtml("settings-clock",date+" "+timeStr)};this.showSaveDialog=function(callBack){if(this.isSettingsChanged()){App.popupMessageScreen.setMessageText(App.lang.get("device-settings-save-confirm"),App.popupMessageScreen.MODE_CHOICE);App.popupMessageScreen.setCallback(function(save){if(save){that.saveSettingsValues();App.device.reboot()}else{that.loadSettingsValues()}callBack()});App.display.showPopupScreen("popup-message")}else{callBack()}};this.key_back=function(){this.key_menu()};this.key_down=function(){settingsMenu.setNextItem()};this.key_up=function(){settingsMenu.setPreviousItem()};this.key_right=function(){this.switchSettingsValue(1)};this.key_left=function(){this.switchSettingsValue(-1)};this.key_enter=function(){var key=settingsMenu.getSelectedDisplayItem();var isRedirect=false;if(settingsList.length>key){isRedirect=settingsList[key]["is_redirect"];key=settingsList[key]["action"]}if(isRedirect){if(key==="udp"){App.device.showUdpProxySettings()}else{if(key==="channels-sort"){App.display.showScreen("sort")}}}};this.key_menu=function(){App.display.showScreen("mainmenu")};this.key_exit=function(){if(App.player.isActive()){App.display.showScreen("player")}else{App.display.showScreen("mainmenu")}};this.key_backspace=function(){this.key_exit()};this.key_power=function(){App.switchStandBy()};this.wheel=function(delta){if(delta>0){this.key_down()}else{this.key_up()}};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){var keys=[{action:"back",label:"label-back"}];App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("settings");App.display.showPopupScreen("popup-key-panel")}else{this.key_enter()}}}_SettingsScreen=new BaseScreen();SettingsScreen.prototype=_SettingsScreen;