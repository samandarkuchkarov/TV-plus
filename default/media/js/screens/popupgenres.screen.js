function PopupGenresScreen(){var that=this;var menuItems=[];var oldCurrentGenres=[];var epgGenresMenu=new BaseMenu({menuId:"epg-genres-menu",menuTag:"div",itemIdPrefix:"epg-genre",itemTag:"div",useFastRefresh:true,hideItemIfEmptyName:true,getItemNameFunc:function(realItemIndex,itemIndex,node){var genre=menuItems[realItemIndex];if(!node){return true}else{if(genre){var epgGenreElement=document.createElement("span");epgGenreElement.setAttribute("id","epg-genre"+itemIndex+"-span");epgGenreElement.setAttribute("class","genre-menu-check-icon");if(App.data.getCheckedProgramGenreById(genre.id)){epgGenreElement.className+=" checked"}node.appendChild(epgGenreElement);var epgGenreLabelElement=document.createElement("span");epgGenreLabelElement.setAttribute("class","genre-menu-label");epgGenreLabelElement.innerHTML=Helper.cropString(genre.name,12,"...");node.appendChild(epgGenreLabelElement)}else{return""}}},onItemClick:function(index){that.key_enter()},onItemMouseOver:function(index){epgGenresMenu.setSelectedItem(index,index)}});this.refreshEpgGenresMenu=function(n,selectedDisplayIndex,selectedSourceIndex){var rows=5;var cols=2;var displayItems=rows*cols;if(n>displayItems){n=displayItems}if(n<cols){epgGenresMenu.setNumberOfColumns(0);epgGenresMenu.setNumberOfRows(1)}else{epgGenresMenu.setNumberOfColumns(cols);epgGenresMenu.setNumberOfRows(Math.ceil(n/cols))}epgGenresMenu.setNumberOfDisplayItems(n);epgGenresMenu.setNumberOfSourceItems(menuItems.length);epgGenresMenu.initMenu();epgGenresMenu.setSelectedItem(selectedDisplayIndex,selectedSourceIndex);epgGenresMenu.redrawMenuItems()};this.init=function(){_PopupGenresScreen.init();App.data.clearCheckedProgramGenreList();var n=menuItems.length;if(n==0){Helper.showById("popup-genres-empty-category")}else{Helper.hideById("popup-genres-empty-category")}this.refreshEpgGenresMenu(n,0,0)};this.show=function(){_PopupGenresScreen.show();if(this.getInited()){this.refreshEpgGenres()}};this.refreshEpgGenres=function(saveSelectedIndex){var n=menuItems.length;if(n>0){Helper.hideById("popup-genres-empty-category")}else{Helper.showById("popup-genres-empty-category")}var selDisplayIndex=0;var selSourceIndex=0;if(saveSelectedIndex){selDisplayIndex=epgGenresMenu.getSelectedDisplayItem();selSourceIndex=epgGenresMenu.getSelectedSourceItem()}epgGenresMenu.clear();this.refreshEpgGenresMenu(n,selDisplayIndex,selSourceIndex)};this.setGenres=function(genres){menuItems=genres};this.isNeedToUpdateProgramList=function(){var currentGenres=App.data.getCheckedProgramGenreList();if(oldCurrentGenres.length>0&&currentGenres.length===0){App.data.clearCheckedProgramGenreList();return true}if(oldCurrentGenres.length===0){return false}for(var i=0;i<currentGenres.length;i++){if(oldCurrentGenres.indexOf(currentGenres[i])===-1&&currentGenres[i]){return true}}return false};this.key_back=function(){this.key_exit()};this.key_enter=function(){var currentGenres=App.data.getCheckedProgramGenreList();var index=menuItems[epgGenresMenu.getSelectedSourceItem()]["id"];var name=menuItems[epgGenresMenu.getSelectedSourceItem()]["name"];var displayIndex=epgGenresMenu.getSelectedDisplayItem();if(currentGenres[index]===0||!currentGenres[index]){App.data.checkProgramGenre(index,name);Helper.addClass("epg-genre"+displayIndex+"-span","checked")}else{App.data.checkProgramGenre(index);Helper.removeClass("epg-genre"+displayIndex+"-span","checked")}};this.key_down=function(){epgGenresMenu.setDownItem()};this.key_up=function(){epgGenresMenu.setUpItem()};this.key_right=function(){epgGenresMenu.setNextItem()};this.key_left=function(){epgGenresMenu.setPreviousItem()};this.key_yellow=function(){App.data.clearCheckedProgramGenreList();this.key_exit()};this.key_exit=function(){var currentGenres=App.data.getCheckedProgramGenreList();if(Helper.getLengthOfRarefiedArray(currentGenres)===menuItems.length){currentGenres=[];App.data.clearCheckedProgramGenreList()}if(!App.categorizedTVScreen.getTimeIntervalPrograms()){if(this.isNeedToUpdateProgramList()){Helper.addClass("categorizedtv-screen-container","loader");this.hide();App.data.requestProgramCategoryChannelList({category_id:App.categorizedTVScreen.getProgramCategoryId()},function(error,interval){oldCurrentGenres=currentGenres.slice();Helper.removeClass("categorizedtv-screen-container","loader");App.categorizedTVScreen.refreshPrograms()})}}else{this.hide();App.data.filterChannelsByProgramGenre(App.categorizedTVScreen.getProgramCategoryId());oldCurrentGenres=currentGenres.slice();App.categorizedTVScreen.refreshPrograms()}};this.mouseEnter=function(param){Helper.addClassForObject(this.getSelfObject(),"mouse-over")};this.mouseLeave=function(param){Helper.removeClassForObject(this.getSelfObject(),"mouse-over")};this.wheel=function(delta){if(delta>0){this.key_down()}else{this.key_up()}};this.key_long_enter=function(){if(App.showHelpButtonPanelFlag){var keys=[{action:"yellow",label:"label-show-all-genres"},{action:"back",label:"label-back"}];App.popupKeyPanelScreen.setKeysForPanel(keys);App.popupKeyPanelScreen.setParentScreen("popup-genres");App.display.showPopupScreen("popup-key-panel")}}}_PopupGenresScreen=new BaseScreen();PopupGenresScreen.prototype=_PopupGenresScreen;